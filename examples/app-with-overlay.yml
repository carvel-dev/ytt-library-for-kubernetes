#! If you want to customize any aspect of the configuration that is not explicitly exposed via app.make(...),
#! you can use [overlay feature](https://github.com/k14s/ytt/blob/master/docs/lang-ref-ytt-overlay.md).
#! For example, below we have `updates()` to force SSL redirection for this particular app.

#@ load("@ytt:template", "template")
#@ load("@ytt:overlay", "overlay")

#@ load("@github.com/k14s/k8s-lib:app/module.lib.yml", "app")

#@ port = 80

#@ def container():
image: hashicorp/http-echo
args:
- #@ "-listen=:" + str(port)
- -text="hello!"
#@ end

#@ def updates():
#@overlay/match by=overlay.subset({"kind":"Ingress"})
---
metadata:
  #@overlay/match missing_ok=True
  annotations:
    #@overlay/match missing_ok=True
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
#@ end

#@ app_config = app.make("hello", container(), port=port).config()

--- #@ template.replace(overlay.apply(app_config, updates()))
